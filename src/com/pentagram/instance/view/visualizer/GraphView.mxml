<?xml version="1.0" encoding="utf-8"?>
<modules:Module xmlns:fx="http://ns.adobe.com/mxml/2009" 
				 xmlns:s="library://ns.adobe.com/flex/spark" 
				 xmlns:mx="library://ns.adobe.com/flex/mx"
				 xmlns:vis="flare.flex.vis.*"
				 xmlns:vo="com.pentagram.model.vo.*" creationComplete="module1_creationCompleteHandler(event)"
				 implements="com.pentagram.instance.view.visualizer.IGraphView"
				 width="100%" height="100%" xmlns:modules="ws.tink.spark.modules.*" contentBackgroundAlpha="0">
	<fx:Script>
		<![CDATA[
			import flare.analytics.optimization.AspectRatioBanker;
			import flare.animate.Transitioner;
			import flare.data.DataSet;
			import flare.data.DataSource;
			import flare.data.converters.Converters;
			import flare.data.converters.IDataConverter;
			import flare.scale.ScaleType;
			import flare.util.palette.SizePalette;
			import flare.vis.Visualization;
			import flare.vis.data.Data;
			import flare.vis.data.NodeSprite;
			import flare.vis.operator.OperatorList;
			import flare.vis.operator.encoder.ColorEncoder;
			import flare.vis.operator.encoder.PropertyEncoder;
			import flare.vis.operator.encoder.ShapeEncoder;
			import flare.vis.operator.encoder.SizeEncoder;
			import flare.vis.operator.layout.AxisLayout;
			
			import mx.events.FlexEvent;
			import mx.events.ResizeEvent;
			
			private var vis:Visualization;
		
			private var _visdata:Data;
			public function set visdata(d:Data):void {
				_visdata = d;
			}
			public function get visdata():Data {
				return _visdata;
			}
			private var banker:AspectRatioBanker;
			private var firstPass:Boolean = true;
			public function visualize(arr:Array,prop1:String,prop2:String,prop3:String):void
			{
				visdata = Data.fromArray(arr);
				vis.continuousUpdates = true;
				vis.data = _visdata;	
			
				var axisLayout:AxisLayout;
				var colorEncoder:ColorEncoder;
				var propEncoder:PropertyEncoder;
				var sizeEncoder:SizeEncoder;
				var sizePalette:SizePalette = new SizePalette(1,20);
				if(firstPass) {
					firstPass = false;
					axisLayout = new AxisLayout("data."+prop1, "data."+prop2);				
					colorEncoder = new ColorEncoder("data.color", Data.NODES,"fillColor", ScaleType.CATEGORIES);
					propEncoder = new PropertyEncoder({lineAlpha: 1, alpha:0.75, buttonMode: true,scaleX: 1, scaleY: 1, size: 1});
					sizeEncoder = new SizeEncoder("data."+prop3, Data.NODES,sizePalette);
					
					vis.operators.add(axisLayout);
					vis.operators.add(propEncoder);
					vis.operators.add(sizeEncoder);
					vis.operators.add(colorEncoder);
					
					
					vis.xyAxes.showBorder = false;
					vis.xyAxes.showXLine = true;
					vis.xyAxes.showYLine = true;
					vis.xyAxes.xAxis.showLines = false;
					vis.xyAxes.yAxis.showLines = false;
				}
				else {
					
					vis.data = visdata;
					axisLayout = vis.operators.getOperatorAt(0) as AxisLayout;
					axisLayout.xField  = "data."+prop1; axisLayout.yField = "data."+prop2;
					
					sizeEncoder = vis.operators.getOperatorAt(2) as SizeEncoder;
					sizeEncoder.source = "data."+prop3;

					
					vis.update(new Transitioner(2.1)).play();
				}
			}
			public function update():void {
				vis.update(new Transitioner(2.1)).play();
			}
			public function updateMaxRadius(value:Number):void {
				var sizeEncoder:SizeEncoder = vis.operators.getOperatorAt(2) as SizeEncoder;
				SizePalette(sizeEncoder.palette).maximumSize = value;
				vis.update(new Transitioner(1)).play();
				
			}
			protected function group1_resizeHandler(event:ResizeEvent):void {
				if(!firstPass) {
					vis.bounds = new Rectangle(0, 0, this.width-100, this.height-100);
					vis.update();
				}
			}

			protected function module1_creationCompleteHandler(event:FlexEvent):void
			{
				var bounds:Rectangle =  new Rectangle(0, 0, this.width-100, this.height-100);
				
				vis = new Visualization();


				vis.x = 50; 
				vis.y = 20;
				vis.bounds = bounds;
				
				holder.addChild(vis);
				this.addEventListener(ResizeEvent.RESIZE,group1_resizeHandler);
			}

		]]>
	</fx:Script>
	<fx:Declarations>
	</fx:Declarations>
	<s:Group width="100%" height="100%">
		<s:SpriteVisualElement id="holder" width="100%" height="100%"/>	
	</s:Group>
	
</modules:Module>
